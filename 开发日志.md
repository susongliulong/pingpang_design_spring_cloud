# 2024/3/24

开发进行到现在完成的主要工作有前后端开发环境的搭建，包含

1. 后端开发环境搭建：导入各种各样的依赖，配置常用的消息转化器，处理跨域和Cookie统一拦截
2. 前端开发环境搭建：使用Vue3
3. 使用git作为版本控制工具

完善前端多个界面的原型设计：

1. 注册和登录界面以及新闻展示界面和教程展示界面
2. 完成重要组件设计：评论框（CommentVue）

完成数据库设计:

1. 使用Power Designer完成数据库设计

后端代码自动生成：

1. 使用mbg自动生成相应的模板类

# 2024/3/29

概要设计阶段所有的工作已经完成，前期进行了大量的预编码工作。接下来结合前期编码以及自身实力对项目进行编写。最终完成整个项目的代码编写。但是在论文撰写中遇到了困难，究竟是先写文档还是先实现？

# 2024/4/7

[springcloud 整合redis_redis_污青-华为云开发者联盟 (csdn.net)](https://huaweicloud.csdn.net/63356736d3efff3090b55c64.html?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~activity-5-122043178-blog-124349947.235^v43^pc_blog_bottom_relevance_base7&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~activity-5-122043178-blog-124349947.235^v43^pc_blog_bottom_relevance_base7&utm_relevant_index=10#devmenu6)

上面的这篇文章涉及到Redis的基础使用，直接复制粘贴即可使用。很快。

完成账号管理模块的设计，实现以及测试工作。主要实现的亮点有：

1. 用户登录失败次数超过三次的时候暂停用户登录1分钟
2. 图片上传和下载

在实现过程中遇到了各种各样的问题，现在对各种问题进行总结

## maven依赖冲突问题

首先需要注意的是每一个Spring Cloud都对因一个Spring Boot版本。这是最基本的版本匹配。

其次需要注意的是Spring Cloud基于Spring Boot，使用到了Spring Boot中一些核心依赖，例如web，test。其他组件整合进入Spring Boot时通常采用\*\***-starter的方式或者spring-boot-starter-\*\*的方式，不要直接导入某个具体的依赖。

不同的组件对Spring Boot的要求不同，例如Spring Boot3中Mybatis Plus的版本和Spring Boot2中的就不一样，如果错误的配置。在启动的时候就会出现某个jar包中不存在指定的类的错误。

## 前端单选框和多选框数据回显问题

无论是单选框radio还是多选框checkBox，都是通过标签中的value属性来控制回显的。需要特别注意value属性的类型。当写成string类型的时候，此时需要特别注意数据回显时v-model绑定的值也为string类型，同理也适用于number类型。代码示例如下：

```vue
<el-form-item label="球龄" prop="playYears">
              <el-radio-group v-model="ruleForm.playYears">
                <el-radio label="1月" :value="1" />
                <el-radio label="3月" :value="3" />
                <el-radio label="1年" :value="12" />
                <el-radio label="5年" :value="60"/>
                <el-radio label="10年" :value="120" />
              </el-radio-group>
</el-form-item>
```

此时playYears应当为number类型，后端传给前端用来数据回显的时候playYears也应当为number类型，而不要错误写成string类型。如下：

```vue
<el-form-item label="球龄" prop="playYears">
              <el-radio-group v-model="ruleForm.playYears">
                <el-radio label="1月" value="1" />
                <el-radio label="3月" value="3" />
                <el-radio label="1年" value="12" />
                <el-radio label="5年" value="60"/>
                <el-radio label="10年" value="120" />
              </el-radio-group>
            </el-form-item>
```

## 使用openfeign进行服务调用

1. 服务调用的时候尽量不要传递HttpServletRequest或者HttpServletResponse参数
2. 服务调用的时候，需要显式的用@RequestParam注明参数的名称，在不写的情况下，方法默认在参数前面加的注解是@RequestBody

## 使用DTO封装前端数据请求，使用Vo返回后台处理数据

## 使用axios出现的异步问题

当同步代码和异步代码同时出现的时候，此时需要注意代码执行的顺序。一种解决方案是对于异步方法，设置参数。由同步代码对参数传值。或者使用if-else语句进行显示控制。

# 2024/4/16

## 完成资讯管理代码编写

1. idea实现热部署

## 生成资讯管理所需要的测试数据

1. 使用Java作为爬虫，所用到的核心API包含Java正则表达式，以及HttpConnection请求客户端
2. Java正则表达式的语法需要熟悉

# 2024/4/19 赛事管理

1. 生成赛事管理所需要的测试数据
2. 获取发布的赛事信息
3. 根据关键词搜索赛事信息
4. 赛事发布
5. 赛事报名
6. 赛事分组

## 爬取https网站的时候需要安装对应网站的证书

证书格式为crt

下载完毕之后，使用keytools工具安装证书

```java
keytool -import -alias <证书别名> -keystore cacerts -file <证书位置>

keytool -list -keystore cacerts -alias <证书别名>
```

在使用第三方代码访问时，将不会报错：

> unable to find valid certification path to requested target

第三方访问代码：

```java
URL url = new URL("https://www.gdut.edu.cn/jgsz/jxjg.htm");
HttpsURLConnection urlConnection = (HttpsURLConnection) url.openConnection();
urlConnection.setRequestMethod("GET");
BufferedReader bufferedReader = new BufferedReader(newInputStreamReader(urlConnection.getInputStream()));
String line;
String collegePattern="target=\"_blank\">(.{2,13})学院</a>";
Pattern pattern = Pattern.compile(collegePattern);
while((line = bufferedReader.readLine())!=null){
     Matcher matcher = pattern.matcher(line);
     while(matcher.find()){
                
     }
}
```

# 2024/4/21

## 完成教程发布模块代码编写

首先实现发布教程功能。

用户点击发送教程前，首先查看用户是否具有发送教程的资格。

用户编辑教程内容之后，发送给后台服务器。

展示用户已经发布的教程信息，点击之后在该页面进行回显（在后台调用的方法应当为saveOrUpdate）

## 在教程展示界面，展示详细的教程信息

初始化的时候，从后台加载数据获取一级菜单和二级菜单的内容。

点击某一个二级菜单的时候，根据教程id在后台获取教程的详细内容。

# 2024/4/23

评论管理实现。

需要放置评论界面的几个地方：教程界面，新闻界面和赛事界面。而评论界面作为子组件，因此涉及到父子组件之间通信的问题。

## vue3中三种传值的方式

1. 父传子的时候

父组件需要申明传递给子组件的属性以及属性值：

```vue
// parent.vue
// 传属性info，且值为parentMessage给子组件Child
<Child :info="parentMessage"></Child>
```

子组件使用定义属性（defineProps）的方式接收来自父组件的值，在template可以直接引用，但是在script中需要使用toRefs方法进行转化。转化之后即可使用。

```vue
<template>
<!-- info是父组件传递过了的值 -->
  <div>我是子组件拿到了父组件的值是{{info}}</div>
</template>
 
<script setup>
import { toRefs, defineProps } from 'vue'
const props = defineProps({
  //子组件接收父组件传递过来的值
  info: String,
})
//使用父组件传递过来的值
const {info} =toRefs(props)
 
</script>
 
<style>
 
</style>
```

2. 子组件传递值给父组件

通过事件的方式进行传递。子组件使用defineEmits定义需要发送给父组件的事件名称。方法的参数为数组类型，可以定义多个参数。再使用方法emits发送事件，并且携带相关参数。

父组件监听子组件发送的事件，且可以获得传来的参数。

3. 子组件向父组件暴露属性

子组件使用defineExpose方法暴露属性，接收的参数为json类型。父组件使用ref来获取子组件传来的属性。

# 2024/4/24

> 4个小时

1. 优化项目
2. 完善毕业论文撰写

## 优化项目

1. 完成分库设计，其中user表数据存在冗余

在userAccount模块中，用户在修改个人信息时

# 进入完善阶段

> 进入该阶段之后，将进一步完善系统的功能，解决系统残留的bug。

## 完善登录逻辑

1. 取消UserReqDispatcher微服务。将验证码的验证放在UserAccount微服务中。
2. 密码加密传输，使用Spring security提供的Bscript对密码进行加密
3. 对账号信息进行脱敏处理
4. 由于采用了分库的设计，在5个数据库中。user表存在冗余，实现在UserAccount更新user信息时同步到其他的数据库。

# 2024/5/7

1. 完善新闻分享逻辑
2. 完善教程编辑逻辑
3. markdown上传图片，保存图片信息

# 2024/5/14 完善赛事报名环节

## 需求分析

1. 选手综合能力评估
2. 选手分组
3. 选手积分管理

选手可以报名参赛，报名参赛之前。首先对选手资质进行校验——查看选手积分是否满足比赛最低积分要求，只有在满足积分要求之后选手才能报名成功。

报名截止的时候，将对选手进行分组。一方面选手分组需要保证分组的随机性，另外一方面还要保证竞技的趣味性。因此在进行分组的时候，先采取随机分组的方式，分组完成之后，按照一定的策略对每一个小组进行校验。

选手的积分获取来源：

1. 选手只要参赛就会获取一个积分
2. 根据参加比赛规模的不同，结合用户在比赛中取得的名次也可以获得额外的积分的奖励

进行分组时，主要考察选手的综合能力。选手的综合能力包含如下四个部分：

1. 发球能力 2. 接发球能力 3. 进攻能力 4. 防守反击能力

在选手第一次参加比赛之前，首先会让用户填写一个问卷，在选手填写完问卷之后。根据选手的回答来初始生成这些能力。

选手下一次参加比赛的时候，如果距离上一次填写问卷的时间超过一个星期。选手可以选择是否重新填写问卷来更新个人能力值。

> 选手比赛结束之后，根据选手比赛过程中的表现来更新选手能力。

分组的策略：

1. 小组内部选手按照发球能力，接发球能力，进攻能力以及防守反击能力从大到小进行排序
2. 计算排名最高的选手和排名最差的选手在各项能力上的差值，各个能力的差值按照权重30%，30%，20%，20%计算得到综合能力差值
3. 如果综合能力差值大于3，该小组应当重新分配。将
4. 对于每个综合能力差值大于三的小组，数量为n。将他们按照按照发球能力，接发球能力，进攻能力以及防守反击能力从大到小进行排序，排序完成之后。第一组选排名最低的选手，第二组选排名第2低的选手，……第n组选排名第n低的选手；接下来，第一组选排名第n+1低的选手，第一组选排名第n+2低的选手，……第n组选排名第n+n低的选手。依次类推，直到每个小组都选完。选完之后，每个小组可能还是不能满足综合能力差值条件，但是已经尽可能照顾到了综合能力较差的选手。因此在该轮分配之后，将不再第二轮分配。

问卷中问题设置：

问卷包含四个部分，分别对应四个能力，每个能力的满分都是100分。用户第一次填写问卷时，每个部分都要填写。以后再次填写时只需要填写自认为有进步的地方。

首先是发球能力：由用户选择可以发的各种球。按照球的旋转，速度以及落点可以分为如下几种情况。

不转，上旋，侧旋，逆旋转，下旋

台内短球，半出台，全出台，底线球，正手小三角，反手小三角

偷长球

其次是接发球能力，常用的接发球技术根据球的旋转和落点可以分为如下几种：

简单攻球，搓球，反手拧拉，摆短

杀球，劈长，拉球，削球

上述的两种能力，在用户选择对应的能力下面的细项之后，由用户对自己的能力进行打分。

为了简化设计，进攻能力和防守能力主要考察的是用户在相持中的表现，对于大多数业余球友而言，这两部分能力很难描述，由用户自己打分。

在用户填完问卷之后，计算生成用户的各个能力。其中进攻能力和防守能力可以直接生成，而对于发球能力和接发球能力，首先对各个子能力划分权重，权重的划分如下表所示：

发球能力：

不转（5%），上旋（5%），侧旋（5%），逆旋转（10%），下旋（15%）

台内短球（5%），半出台（10%），全出台（5%），底线球（15%），正手小三角（10%），反手小三角（5%）

偷长球（10%）

接发球能力：

简单攻球（5%），搓球（20%），反手拧拉（20%），摆短（10%）

杀球（10%），劈长（10%），拉球（20%），削球（5%）

按照权重计算用户的发球能力和接发球能力。

比赛结束之后，由管理人员对选手积分进行加分处理。

## 设计

前端界面设计。

用户点击确认报名按钮之后，系统检测用户上次填写问卷时间，如果填写问卷时间间隔超过一个星期。此时可以由用户自己选择是否重新填写问卷；如果没有超过，弹出框，显示用户的报名信息，其中选手的昵称和联系方式可以改变。其他的内容不能改变。

